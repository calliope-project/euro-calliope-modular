templates:
  pv_on_roof:  # from [@JRC:2014] Table 9
    name: Roof mounted PV
    carrier_out: electricity
    base_tech: supply
    lifetime: 25
    source_unit: per_cap
    cost_flow_cap:
      data: {{ 880000 * scaling_factors.specific_costs}} # {{ (1 / scaling_factors.specific_costs) | unit("EUR2013/MW") }}
      index: monetary
      dims: costs
    cost_om_annual:
      data: {{ (880000 * 0.02 - 1 * 8760 * capacity_factors.pv) * scaling_factors.specific_costs }} # {{ (1 / scaling_factors.specific_costs) | unit("EUR2013/MW") }} 2% of CAPEX
      index: monetary
      dims: costs
    cost_flow_out:
      data: {{1 * scaling_factors.specific_costs}} # {{ (1 / scaling_factors.specific_costs) | unit("EUR2013/MW") }} stolen from om_annual for technical reasons
      index: monetary
      dims: costs

techs:
  roof_mounted_pv:
    name: Roof mounted PV
    template: pv_on_roof

data_sources:
  roof_mounted_pv_timeseries:
    source: supply/capacityfactors-rooftop-pv.csv
    columns: nodes
    rows: timesteps
    add_dims:
      techs: roof_mounted_pv
      parameters: source_use_max

nodes:
  {% for id, location in locations.iterrows() %}
  {{ id }}:
    techs:
      roof_mounted_pv:
        flow_cap_max: {{ location.eligibility_rooftop_pv_mw * scaling_factors.power  }} # {{ (1 / scaling_factors.power) | unit("MW") }}
  {% endfor %}

overrides:
  dea-renewable-cost-pv-roof-mounted: # from [@DEA:2020]
    templates.pv_on_roof: #  Sheet 22 - Photovoltaics Small (last updated 2016)
      lifetime: 40 # inverter lifetime is shorter but the replacement cost is included in O&M
      cost_flow_cap:
        data: {{ 587500 * scaling_factors.specific_costs}} # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MW") }}
        index: monetary
        dims: costs
      cost_om_annual:
        data: {{ (9135  - 1 * 8760 * capacity_factors.pv) * scaling_factors.specific_costs }} # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MW") }}
        index: monetary
        dims: costs
      cost_flow_out:
        data: {{1 * scaling_factors.specific_costs }} # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MW") }} stolen from om_annual for technical reasons
        index: monetary
        dims: costs

  directional-rooftop-pv:
    techs:
      roof_mounted_pv:
        active: False
      roof_mounted_pv_s_flat:
        name: Roof mounted PV south-facing and flat
        template: pv_on_roof
      roof_mounted_pv_n:
        name: Roof mounted PV north-facing
        template: pv_on_roof
      roof_mounted_pv_e_w:
        name: Roof mounted PV east-facing and west-facing
        template: pv_on_roof

    data_sources:
      roof_mounted_pv_s_flat_timeseries:
        source: supply/capacityfactors-rooftop-pv-s-flat.csv
        columns: nodes
        rows: timesteps
        add_dims:
          techs: roof_mounted_pv_s_flat
          parameters: source_use_max
      roof_mounted_pv_n_timeseries:
        source: supply/capacityfactors-rooftop-pv-n.csv
        columns: nodes
        rows: timesteps
        add_dims:
          techs: roof_mounted_pv_n
          parameters: source_use_max
      roof_mounted_pv_e_w_timeseries:
        source: supply/capacityfactors-rooftop-pv-e-w.csv
        columns: nodes
        rows: timesteps
        add_dims:
          techs: roof_mounted_pv_e_w
          parameters: source_use_max

    nodes:
      {% for id, location in locations.iterrows() %}
      {{ id }}.techs:
        roof_mounted_pv_s_flat:
          flow_cap_max: {{ location.eligibility_rooftop_pv_s_flat_mw * scaling_factors.power  }} # {{ (1 / scaling_factors.power) | unit("MW") }}
        roof_mounted_pv_n:
          flow_cap_max: {{ location.eligibility_rooftop_pv_n_mw * scaling_factors.power  }} # {{ (1 / scaling_factors.power) | unit("MW") }}
        roof_mounted_pv_e_w:
          flow_cap_max: {{ location.eligibility_rooftop_pv_e_w_mw * scaling_factors.power  }} # {{ (1 / scaling_factors.power) | unit("MW") }}
      {% endfor %}
